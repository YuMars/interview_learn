网络

网络互连模型

OSI参考模型（7层）（Open System Interconnect Reference Model）
应用层
表示层
会话层
运输层
网络层
链路层
物理层

TCP/IP协议（4层）
应用层（应用层、表示层、会话层）
运输层
网际层（网络层）
网络接口层（数据链路层、物理层）

学习研究（5层）
应用层（应用层、表示层、会话层） （报文）       HTTP-1.1-GET       				 FTP、HTTP、SMTP、DNS、DHCP  
运输层 						 （段Segments） TCP头：包含端口号、序列号				 TCP、UDP
网际层（网络层）				 （包Packets）  IP头：包含IP地址-目标IP地址-源IP地址-协议（ICMP=1、TCP=6、UDP=17） IP、ARP、ICMP
数据链路层 					 （帧frames）   以太网头：包含Mac地址-以太网相关信息              CSMA/CD、PPP
物理层  						 （比特流bits）

分层的好处：
	1.各层独立:限制了依赖关系的范围，各层之间使用标准化的接口，各层不需要知道山西盖层是如何工作的，增加或者修改一个应用层协议不会影响传输层协议。
	2.灵活性更好：比如路由器不需要应用层和传输层，分层以后路由器就可以只需加载更少的几个协议层
	3.易于测试和维护：提高了可测试性，可以独立的测试特定层，某一层有了更好的实现可以整体替换掉
	4.能促进标准化：每一层职测清楚，方便进行标准化



# 物理层：定义了接口标准、线缆标准、传输速率、传输方式等
	模拟信号：
	1.连续的信号，适合长距离传输
	2.抗干扰能力差，收到干扰时波形变形很难纠正

	数字信号：
	1.离散的信号，不适合长距离传输
	2.抗干扰能力强，收到干扰时波形失真可修复

	数据通信模型
		局域网
		PC ----数字信号（网线）---- 交换机 -----数字信号（网线）------ PC

		广域网
		PC ----数字信号（网线）---- 调制解调器 ----- 模拟信号（电话线）----- 调制解调器 ----- 数字信号（网线）------ PC

	信道（Channel）
		信息传输的通道，一条传输介质上（比如网线）可以有多条信道
		单工通信：信号只能往一个放线传输，任何时候都不能改变信号的传输反向（无线电广播）
		半双工通信：信号可以双向传输，但是必须交通通行（对讲机）
		全双工通信：信号可以同时双向传输（手机）

# 数据链路层：
	链路：从一个节点到相邻节点的一段物理线路，中间没有其他交换节点
	数据链路：在一条链路上传输数据时，需要有对应的通信协议来控制数据的传输。不同类型的数据链路，通信协议可能不同。
		广播信道：CSMA/CD协议（不如同轴电缆，集线器等组成的网络）
		点对点信道：PPP协议（比如路由器之间的信道）
	数据链路的3个基本问题：
		1.封装成帧
			帧的数据部分：网络层传递下来的数据包（IP数据包）
			最大传输单元：每一种数据链路协议都规定了所能够传输的帧的数据长度上限，以太网的最大传输单元1500字节
		2.透明传输
			数据部分一旦出现SOH、EOT需要进行转义（用ESC填充）
		3.差错检验
			FCS：根据数据部分+首部计算得出

	CSMA/CD协议
		1.载波侦听多路访问/冲突检测
		使用率CSMA/CS的网络可以成为以太网，它传输的是以太网帧
			以太网帧的格式有：Ethernet V2标准、IEEE的802.3标准
			使用最多的是：Ethernet V2标准
		为了能够检测正在发送的真是否产生冲突，以太网的帧至少要64字节

		用交换机组件的网络，已经支持全双工通信，不需要再使用CSMA/CD，但它传输的帧依然是以太网帧，所以交换机组件网络，依然可以叫做以太网

	Ethernet V2帧 
																								IP层
						6 		 6        2        					46-1500	         	4
					目标Mac地址-源Mac地址-类型（IPV6、IPV4）--------数据（IP数据包）-------FCS 		MAC层
				8字节|						以太网Mac帧	  					|       			物理层
前同步码7 ---帧开始定界符1----												没有帧结束符

	首部：源MAC地址+目标MAC地址+网络类型
	以太网帧：首部+收据+FCS
	数据的长度至少是：64-6-6-2-4=46

	当数据部分的长度小于46字节时：1.数据链路层会在数据的后面加入一些字节填充2.接收端会将添加的字节去掉
	长度总结：以太网帧的数据长度46-1500 以太网帧的长度：64-1518（源Mac地址+目标MAC地址+网络类型+数据+FCS）

	PPP协议（Point to Point Potocol）

			| 	      首部	   		  |
			F  ---- A ---- C ---- 协议 ---- 信息部分 ---- FCS ---- F
	字节数   1       1      1       2     不 超过1500字节  2       1
 

# 网络层
	网络层数据包（IP数据包，Packet）由首部、数据2部分组成
	数据：很多时候是有传输层传递下来的数据段

			|                  32位					|
	——————	版本 --- 首部长度 --- 区分服务 ---   总长度
	首部		标识 --- 标志 --- 片偏移
	20字节	生存时间 --- 协议 --- 首部检验和
			源IP地址
	——————	目标IP地址
			可选字段（长度可变） --- 填充
			数据部分（最大1460）
			|  			总长度65535位				|

	版本：占4位 IPV6、IPV4
	首部长度：占4位，二进制乘以4才是最终长度，20最小值，60最大值
	区分服务：(QOS)占8位，可以用于提高网络质量
	总长度：占16位 首部+数据的长度之和，最大值是65535。
		由于帧的数据不能超过1500字节，所以过大的IP数据包，需要分成片传输给数据链路层
		每一篇都有自己的网络层首部
	标识：占16位，数据包的ID，当数据包过大进行分片时，同一个数据包的所有片的标识都一样，有一个计数器专门管理数据包的ID，每发出一个数据包，ID就+1
	标志：占3位，第一位：（Reserved bit）保留。第二位：（Don't Fragment）1代表不允许分片，0代表允许。第三位：（More fragments）1代表不是最右一片，0代表是最后1片。··
	片偏移：占13位，片偏移乘以8=字节偏移，每一片段长度一定是8的整数倍 
	生存时间（TTL）：占8位，每个路由器在转发之前会将TTL减1，一旦发现TTL减为0，路由器会返回错误报告。观察使用ping命令后的TTL，能够推测出对方的操作系统，中间经历了多少个路由器
		Window： 128
		Linux：64（255）
		Mac OS：60
		Mac OS X：64 


# 传输层（TCP：Transmission Control Protocol）
	传输层有两个协议：1.TCP，传输控制协议
					2.UDP（User Datagram Protocol），用户数据报协议
								 		TCP 									UDP
		连接性						面向链接									无连接
		可靠性						可靠传输，不丢包							不可靠传输，尽最大努力交付，可能丢包
		首部占用空间					大 											小
		传输速率  					慢 											快
		资源消耗						大 											小
		应用场景						浏览器、文件传输、邮件发送 						音视频通话、直播
		应用层协议					HTTP、HTTPS、FTP、SMTP、DNS					DNS


	UDP
	UDP是无连接，减少了建立和释放链接的开销
	UDP尽最大能力交付，不保证可靠交付，隐藏不需要维护一些复杂的参数，首部只有8个字节（TCP首部至少20字节）
	UDP长度：占16位，首部的长度+数据的长度
													 ————————	
				16位源端口号 				16位目标端口号  |  
				16位UDP长度				16位UDP检验和  8字节
				数据 								 ————————
	检验和：计算内容=伪首部+首部+数据
			伪首部：源IP地址、目标IP地址、0（保留）、17（协议）、UDP长度 
			首部：源端口、目标端口、长度、检验和
	端口：占16位，可以推测出端口号的取值范围是0-65535，客户端的端口是临时开启的随机端口，防火墙可以设置开启、关闭某些端口提高安全性
		netstat -an:查看被占用的端口
		netstat -anb：查看被占用的端口、占用端口的应用程序
		telnet 主机 端口：查看市口可以访问主机的 某个端口


	TCP
	| 								16字节								|			16字节					|	
	----	源端口  																目标端口
			序列号
	20字节	确认号
			数据偏移	 	保留（flags） URG  ACK   PSH   RST   SYN   FIN   		窗口
	----	检验和    															紧急指针
			选项（长度可变） 														填充
 
	数据偏移：占4位，取值范围0x0101-0x1111，数据便宜乘以4=首部长度

			 UDP首部中占16位的长度字段是冗余的，纯粹是为了保证首部是32bit对齐
			 TCP/IP的数据长度，完全可以由IP数据包的首部推测出来
			 传输层的数据长度=网络层的总长度-网络层首部的长度-传输层首部的长度
	检验和： 伪首部+首部+数据
			伪首部：占用12字节，仅在计算检验和时起作用，并不会传递给网络层
	URG：（Urgent）
		当URG = 1时，紧急指针字段才有效。表明当前报文段中有紧急数据，应优先尽快传递

	ACK：（Acknowledge）
		当ACK = 1时，确认号字段才有效

	PSH：（Push）

	RST：（Reset）
		当RST = 1时，表明连接中出现严重差错，必须释放连接，然后重新建立链接。

	可靠传输：



	流量控制：



	拥塞控制：





	连接管理：












